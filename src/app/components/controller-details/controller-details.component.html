<div class="controller-container">
  <div class="controller-header">
    <div class="header-main">
      <div class="title-section">
        <span class="status-indicator">
          <i [class.online]="controller?.status === 'online'" [class.offline]="controller?.status !== 'online'"></i>
        </span>
        <h2>{{ controller?.name }}</h2>
      </div>
      <div class="action-buttons">
        <button (click)="showInfo()">Info</button>
        <button (click)="upload()">Upload to controller</button>
        <button (click)="test()">Test</button>
      </div>
    </div>
  </div>

  <!-- Mobile Tabs -->
  <div class="mobile-tabs">
    <button class="tab-button" [class.active]="activeTab === 'outputs'" (click)="setActiveTab('outputs')">
      Outputs
    </button>
    <button class="tab-button" [class.active]="activeTab === 'inputs'" (click)="setActiveTab('inputs')">
      Inputs
    </button>
    <button class="tab-button" [class.active]="activeTab === 'buttons'" (click)="setActiveTab('buttons')">
      Buttons
    </button>
  </div>

  <!-- Desktop View -->
  <div class="desktop-view">
    <h3 class="section-title">Outputs</h3>
    <div class="outputs-container">
      <app-output-card *ngFor="let output of controller?.outputs" 
                       [output]="output" 
                       [mac]="controller?.mac"
                       (edit)="onEditOutput($event)">
      </app-output-card>
    </div>

    <h3 class="section-title">Inputs</h3>
    <div class="inputs-container">
      <app-input-card *ngFor="let input of findInputs(controller?.inputs)"
                      [input]="input" 
                      [mac]="controller?.mac">
      </app-input-card>
    </div>

    <h3 class="section-title">Buttons</h3>
    <div class="buttons-container">
      <app-button-card *ngFor="let input of findButtons(controller?.inputs)"
                       [input]="input" 
                       [mac]="controller?.mac">
      </app-button-card>
    </div>
  </div>

  <!-- Mobile View -->
  <div class="mobile-view">
    <div class="tab-content" 
         [ngClass]="{
           'active': activeTab === 'outputs',
           'slide-right': getTabAnimationClass('outputs') === 'slide-right',
           'slide-left': getTabAnimationClass('outputs') === 'slide-left'
         }">
      <div class="outputs-container">
        <app-output-card *ngFor="let output of controller?.outputs" 
                         [output]="output" 
                         [mac]="controller?.mac"
                         (edit)="onEditOutput($event)">
        </app-output-card>
      </div>
    </div>

    <div class="tab-content" 
         [ngClass]="{
           'active': activeTab === 'inputs',
           'slide-right': getTabAnimationClass('inputs') === 'slide-right',
           'slide-left': getTabAnimationClass('inputs') === 'slide-left'
         }">

      <div class="inputs-container">
        <app-input-card *ngFor="let input of findInputs(controller?.inputs)"
                        [input]="input" 
                        [mac]="controller?.mac">
        </app-input-card>
      </div>
    </div>

    <div class="tab-content" 
         [ngClass]="{
           'active': activeTab === 'buttons',
           'slide-right': getTabAnimationClass('buttons') === 'slide-right',
           'slide-left': getTabAnimationClass('buttons') === 'slide-left'
         }">
      <div class="buttons-container">
        <app-button-card *ngFor="let input of findButtons(controller?.inputs)"
                         [input]="input" 
                         [mac]="controller?.mac">
        </app-button-card>
      </div>
    </div>
  </div>

  <!-- Info Popup -->
  <div class="popup-overlay" *ngIf="showInfoPopup" (click)="showInfoPopup = false">
    <div class="popup-content" (click)="$event.stopPropagation()">
      <div class="popup-header">
        <h3>Controller Information</h3>
        <button class="close-button" (click)="showInfoPopup = false">
          <img src="assets/icons/close.svg" width="20" height="20" alt="Close" />
        </button>
      </div>
      <div class="popup-body">
        <div class="status-info">
          <p><span>Memory</span> <span>{{ controller?.freememory }}</span></p>
          <p><span>Uptime</span> <span>{{ controller?.uptime }}</span></p>
          <p><span>Uptime Raw</span> <span>{{ controller?.uptimeraw }}</span></p>
          <p><span>Curdate</span> <span>{{ controller?.curdate }}</span></p>
          <p><span>Device Name</span> <span>{{ controller?.devicename }}</span></p>
          <p><span>Description</span> <span>{{ controller?.description }}</span></p>
          <p><span>Version</span> <span>{{ controller?.version }}</span></p>
          <p><span>RSSI</span> <span>{{ controller?.rssi }}</span></p>
          <p><span>ETH IP</span> <span>{{ controller?.ethip }}</span></p>
          <p><span>WIFI IP</span> <span>{{ controller?.wifiip }}</span></p>
          <p><span>MAC</span> <span>{{ controller?.mac }}</span></p>
        </div>
      </div>
    </div>
  </div>
</div>
